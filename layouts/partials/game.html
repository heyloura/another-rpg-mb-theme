<dialog id="gameModal" class="frame border-frame">
	<button onclick="document.getElementById('gameModal').close();">close</button>
	<div id="gameContainer" class="world">
        {{ partial (printf "areas/area_%s.html" "0") . }}
        {{ partial (printf "areas/area_%s.html" "1") . }}
        {{ partial (printf "areas/area_%s.html" "2") . }}
        {{ partial (printf "areas/area_%s.html" "3") . }}
    </div>
    <script>
        document.addEventListener("click", function(event){
            if(event.target.hasAttribute('data-player')) {

            }

            if(event.target.classList.contains('move')) {
                
                var playerEl = document.querySelector('[data-player]');
                var player = parseInt(document.querySelector('[data-player]').getAttribute('data-id'));
                var destination = parseInt(event.target.getAttribute('data-id'));

                // remove player graphic
                playerEl.removeAttribute('data-player')
                playerEl.classList.remove('knight-left');
                playerEl.classList.remove('knight-right');
                event.target.setAttribute('data-player','');

                //remove moves
                var moves = [...document.querySelectorAll('.move')];

                moves.forEach(element => {
                    element.classList.remove('move');
                });

                var w;
                var a;
                var s;
                var d;
                if(player - destination == 1) {
                    alert('a','[data-id="' + (destination - 1) + '"]')
                    event.target.classList.add('knight-left');
                    a = document.querySelector('[data-id="' + (destination - 1) + '"]');
                }
                if(player - destination == -1) {
                    alert('d','[data-id="' + (destination +1) + '"]')
                    event.target.classList.add('knight-right');
                    d = document.querySelector('[data-id="' + (destination + 1) + '"]');
                }
                if(player - destination < -1) {
                    alert('s','[data-id="' + (destination +18) + '"]')
                    event.target.classList.add('knight-right');
                    s = document.querySelector('[data-id="' + (destination + 18) + '"]');
                }
                if(player - destination > 1) {
                    alert('w','[data-id="' + (destination -18) + '"]')
                    event.target.classList.add('knight-left');
                    w = document.querySelector('[data-id="' + (destination - 18) + '"]');
                }

                // check valid moves
                if(a) {
                    a.classList.add('move');
                }
                if(d) {
                    d.classList.add('move');
                }
                if(w) {
                    w.classList.add('move');
                }
                if(s) {
                    s.classList.add('move');
                }
                
                // Make the bad guys move ...
            }
        });    
    </script>
</dialog>